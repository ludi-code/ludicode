<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">


	<title>Ludicode</title>


	<!-- bootstrap -->
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/bootstrap-theme.min.css">
	<link rel="stylesheet" href="css/bootstrap-toggle.min.css">
	<link rel="stylesheet" href="css/style.css">

	<!-- Code local -->
	<script type="text/javascript" src="libs/jquery.js"></script>
	<script type="text/javascript" src="libs/bootstrap.js"></script>
	<script type="text/javascript" src="libs/bootstrap-toggle.min.js"></script>
	<script type="text/javascript" src="scripts/page_controllers/all.js"></script>


	<!-- Code dessin -->
	<link rel="stylesheet" href="css/draw_ui.css" />
	<script src="libs/skulpt/skulpt.js"></script>
	<script src="libs/skulpt/skulpt-stdlib.js" type="text/javascript"></script>

	<link rel="stylesheet" href="libs/code_mirror/codemirror.css">
	<link rel="stylesheet" href="libs/code_mirror/theme.css">
	

	<script src="libs/code_mirror/codemirror.js"></script>
	<script src="libs/code_mirror/parsepython.js"></script>


	<link rel="stylesheet" href="libs/sweetalert/sweetalert.css" />
	<script src="libs/sweetalert/sweetalert.min.js"></script>


	<link rel="stylesheet" href="libs/alertify/css/alertify.css" />
	<link rel="stylesheet" href="libs/alertify/css/themes/default.css" />	
	<script src="libs/alertify/alertify.min.js"></script>	


	<script type="text/javascript">

	var running = false;
	var last_output = "";



	//Read function
	function pythonEditorbuiltinRead(x) {
		if (Sk.builtinFiles === undefined
			|| Sk.builtinFiles["files"][x] === undefined)
			throw "File not found: '" + x + "'";
		return Sk.builtinFiles["files"][x];
	}

	function pythonEditorOutputHandler(text){
		last_output = (last_output + text);
	}


	function runPython(editor_elem, canvas_elem, run_callback, exec_callback){

		if (running) return false;




		//Turtle graphics
		(Sk.TurtleGraphics || (Sk.TurtleGraphics = {})).target = canvas_elem;

		last_output = "";
		running = true;
		run_callback();


		var ePromise = Sk.misceval.asyncToPromise(function() {
			return  Sk.importMainWithBody("<stdin>", false, editor_elem.getValue(), true);
		});


		ePromise.then(function(mod) {
			running = false;
			exec_callback(last_output,"success");
		}, function(err) {
			running = false;
			exec_callback(last_output, "error");
		});


	}



	function initPythonEditor(editor_elem,canvas_elem, run_link, run_callback,execution_callback){
		var python_editor = CodeMirror(editor_elem, {
			lineNumbers: true,
			indentUnit: 4,
			tabMode: "shift",
			mode: "python",
			theme: "dracula",
			value:"import turtle\nt = turtle.Turtle()\nt.shape('turtle')\nfor c in ['red', 'green', 'yellow', 'blue']:\n    t.color(c)\n    t.forward(75)\n    t.left(90)\n\n",
			extraKeys: {
				Tab: function(cm) {
					var spaces = Array(cm.getOption("indentUnit") + 1).join(" ");
					cm.replaceSelection(spaces, "end", "+input");
				}
			}
		});


		python_output = $("<pre></pre>");
		python_output.addClass("output_bottom");
		python_output.text("OUTPUT\n");
		python_output.appendTo($(editor_elem));

		//Run

		$(run_link).click(function(e){
			runPython(python_editor, canvas_elem, run_callback, execution_callback);
		});

	}


			//Configuring skulpt
			Sk.pre = "";
			Sk.configure({
				output : pythonEditorOutputHandler,
				read : pythonEditorbuiltinRead
			});

					//External libraries
					Sk.externalLibraries = {

					};




					$(document).ready(function(){



						//Demo
						initPythonEditor(document.getElementById("python_eleve_editor"),"python_eleve_canvas",$("#python_eleve_run_link"),
							function(){

							},
							function(output, status){
								if(status == "success"){
									$("#run_link").show();
									alertify.success('Le code a bien été executé');
								}
								else{
									$("#run_link").show();
									swal("Oops", "Un problème est survenu dans le code ... \n\n" + output.toString(), "error");

								}
							});



						//Editeur
						initPythonEditor(document.getElementById("python_enseignant_editor"),"python_enseignant_canvas",$("#python_enseignant_run_link"),
							function(){

							},
							function(output, status){
								if(status == "success"){
									$("#run_link").show();
									alertify.success('Le code a bien été executé');
								}
								else{
									$("#run_link").show();
									swal("Oops", "Un problème est survenu dans le code ... \n\n" + output.toString(), "error");

								}
							});



					});

</script>


</head>

<body>
	<div id="fb-root"></div>
	<nav class="navbar navbar-inverse">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed"
				data-toggle="collapse" data-target="#navbar" aria-expanded="false"
				aria-controls="navbar">
				<span class="sr-only">Toggle navigation</span> <span
				class="icon-bar"></span> <span class="icon-bar"></span> <span
				class="icon-bar"></span>
			</button>
			<a class="navbar-brand menu_bar_element" id="home_bar"
			href="index.html">Ludicode</a>
		</div>
		<div id="navbar" class="navbar-collapse collapse">

			<ul class="nav navbar-nav">

				<li class="menu_bar_element" id="levels_bar"><a
					href="levels.html">Jouer</a></li>
					<li class="menu_bar_element" id="levels_bar"><a
						href="dessin.html">Dessiner</a></li>
						<li class="menu_bar_element" id="editor_bar"><a
							href="editor.html">Editeur</a></li>
							<li class="menu_bar_element" id="ludidoc_bar"><a
								href="ludidoc.html">Ludidoc</a></li>
								<li class="menu_bar_element" id="leaderboard_bar"><a
									href="leaderboard.html">Classement</a></li>

								</ul>

								<div class="navbar-form navbar-right">
									<div id="login_navbar">
										<div class="form-group">
											<input id="name_login" type="text" placeholder="Pseudo"
											class="form-control" /> <input id="password_login"
											type="password" placeholder="Mot de passe" class="form-control" />
											<button id="login_send" type="submit" class="btn btn-success"
											data-toggle="popover">Envoyer</button>
										</div>
										<div class="form-group">
											<a href="register.html" type="button"
											class="menu_bar_element btn btn-info">M'enregistrer</a>
										</div>
									</div>
									<div id="info_profil_navbar">
										<a id="user_icon" href="profile.html" class="menu_bar_element"
										data-toogle="tooltip" title="Mon profil"> <span
										class="glyphicon glyphicon-user" aria-hidden="true"></span>
									</a> <a href="chat.html" data-toogle="tooltip" title="Mes messages">
									<span class="glyphicon glyphicon-comment" aria-hidden="true">
									</span>
								</a> <a id="notif_icon" href="#" data-toogle="tooltip"
								data-title="Mes notifications"> <span
								class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
							</a> <a id="options_icon" class="menu_bar_element" href="options.html"
							data-toogle="tooltip" title="Paramètres"> <span
							class="glyphicon glyphicon-cog" aria-hidden="true"></span>
						</a> <a id="logout_icon" href="#" data-toogle="tooltip"
						title="Deconnéxion"> <span class="glyphicon glyphicon-off"
						aria-hidden="true"></span>
					</a>
				</div>
			</div>
		</div>
		<!--/.navbar-collapse -->
	</div>
</nav>


<div class="container main_panel" id="home_pane">
	<div class="row">
		<h1>Dessiner avec la programmation</h1>

		<div class="draw_container">
			<div class="title">
				Ecrivez
				du code dans la fenêtre ci-dessous pour commencer à dessiner !
			</div>

			<div class="centered">
				<div class="draw_toolbox" id="python_eleve_editor" sttyle="float:left;">
					<div class="toolbar">
						<div class="container">
							<div id="python_eleve_run_link" style="color: blue; text-decoration: underline; cursor:pointer"><div class="tlb_btn">►</div>Lancer votre programme </div>
						</div>
					</div>
				</div>	

				<div class="draw_toolbox" style="float:right;">
					<div id="python_eleve_canvas"></div>
				</div>	

			</div>
		</div>

		<br/>
		<h1>Editeur - Prototype</h1>



		<div class="draw_container">
			<div class="title">
				Programmer un niveau
			</div>

			<div class="centered">
				<div class="draw_toolbox" id="python_enseignant_editor" sttyle="float:left;">
					<div class="toolbar">
						<div class="container">
							<div id="python_enseignant_run_link" style="color: blue; text-decoration: underline; cursor:pointer" ><div class="tlb_btn">►</div>Lancer votre programme </div>
						</div>
					</div>
				</div>	

				<div class="draw_toolbox" style="float:right;">
					<div id="python_enseignant_canvas"></div>
				</div>	

			</div>
		</div>







	</div>

	<br />




</div>
</div>
<!-- container home page -->

<footer class="container">
	<div class="row">
		<hr />
		<p>&copy; Dashin Games 2015</p>
	</div>
</footer>
</body>
</html>

